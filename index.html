<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Soy Tomé - Red de Emergencia</title>
    
    <!-- TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- LEAFLET CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- CONFIGURACIÓN DE ESTILO -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], display: ['Playfair Display', 'serif'] },
                    colors: { 
                        gold: { 300: '#fde047', 400: '#fbbf24', 500: '#f59e0b', 600: '#d97706', 700: '#b45309', 800: '#92400e' }, 
                        whatsapp: '#25D366',
                        brand: { bg: '#050505', card: '#1a1a1a', accent: '#6366f1' },
                        crisis: { red: '#ef4444', green: '#10b981', alert: '#f59e0b' }
                    },
                    animation: {
                        'liquid-gold': 'liquid 15s ease infinite',
                        'fade-in': 'fadeIn 0.6s ease-out forwards',
                        'pulse-emergency': 'pulseEmergency 1.5s infinite',
                        'vibrate': 'vibrate 0.3s linear infinite',
                    },
                    keyframes: {
                        liquid: { '0%': { backgroundPosition: '0% 50%' }, '50%': { backgroundPosition: '100% 50%' }, '100%': { backgroundPosition: '0% 50%' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        pulseEmergency: { '0%, 100%': { opacity: '1' }, '50%': { opacity: '0.5' } },
                        vibrate: { '0%': { transform: 'translate(0)' }, '20%': { transform: 'translate(-1px, 1px)' }, '40%': { transform: 'translate(-1px, -1px)' }, '60%': { transform: 'translate(1px, 1px)' }, '80%': { transform: 'translate(1px, -1px)' } }
                    }
                }
            }
        }
    </script>

    <!-- IMPORT MAP -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.330.0",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js"
        }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <style>
        body { background-color: #050505; color: #fff; margin: 0; overflow-x: hidden; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        .bg-liquid-gold {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: linear-gradient(-45deg, #0f0f0f, #1a1a1a, #271a00, #451a03);
            background-size: 400% 400%;
            animation: liquid-gold 15s ease infinite;
        }

        .glass-dark { background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .diadema { background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(25px); border-bottom: 1px solid rgba(251, 191, 36, 0.2); box-shadow: 0 10px 40px -10px rgba(0,0,0,0.8); }
        .btn-premium { background: linear-gradient(135deg, #b45309, #f59e0b); color: black; box-shadow: 0 0 15px rgba(245, 158, 11, 0.3); border: 1px solid #fcd34d; }
        .whatsapp-float { position: fixed; top: 50%; right: 0; transform: translateY(-50%); z-index: 50; background: #25D366; padding: 12px; border-top-left-radius: 12px; border-bottom-left-radius: 12px; box-shadow: 0 0 20px rgba(37, 211, 102, 0.4); border: 1px solid rgba(255,255,255,0.1); }
        
        .leaflet-container { width: 100%; height: 100%; background: #e5e7eb; z-index: 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .rich-text p { margin-bottom: 0.8em; color: #a1a1aa; line-height: 1.6; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Settings, ShoppingBag, Music, Home, Menu, X, Plus, Trash2, Edit3, Image, Lock, Play, Pause, SkipForward, SkipBack, Share2, MapPin, DollarSign, Loader2, ShoppingCart, User, Minus, Calendar, ExternalLink, Package, ArrowLeft, Save, Siren, Shield, Flame, Dog, FileText, AlertTriangle, RefreshCw, Navigation, LogIn, LogOut, HandHeart, Megaphone, Phone } from 'lucide-react';
        
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, updateDoc, query, getDoc, increment, setDoc } from 'firebase/firestore';
        import { getAuth, signInAnonymously, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from 'firebase/auth';

        // ---------------------------------------------------------
        // 1. CONFIGURACIÓN DE FIREBASE
        // ---------------------------------------------------------
        const firebaseConfig = {
            apiKey: "AIzaSyCSljrHBziUyLcTGjyx1ignV8NB8rCsL2U",
            authDomain: "soy-tome-web.firebaseapp.com",
            projectId: "soy-tome-web",
            storageBucket: "soy-tome-web.firebasestorage.app",
            messagingSenderId: "1074104457245",
            appId: "1:1074104457245:web:f5e2ffc4b9b72285a28ef4",
            measurementId: "G-CFLWJG3WB4"
        };

        let db = null;
        let auth = null;
        
        try {
            if (firebaseConfig.apiKey) {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
            }
        } catch (e) { console.error("Firebase Error:", e); }

        // --- UTILS ---
        const formatCLP = (val) => new Intl.NumberFormat('es-CL', {style:'currency', currency:'CLP'}).format(val);
        const compressImage = (file) => new Promise((resolve) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (e) => {
                const img = new window.Image();
                img.src = e.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const scale = 800 / img.width;
                    canvas.width = 800; canvas.height = img.height * scale;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    resolve(canvas.toDataURL('image/jpeg', 0.7));
                }
            }
        });
        const fixSunoLink = (url) => { if (!url) return ''; if (url.includes('/embed/')) return url; try { const parts = url.split('/song/'); if (parts.length > 1) { const idPart = parts[1].split('?')[0]; const id = idPart.split('/')[0]; return `https://suno.com/embed/${id}`; } } catch (e) {} return url; };
        const safeLoad = (key, def) => { try { return JSON.parse(localStorage.getItem(key)) || def; } catch { return def; } };

        // --- HOOKS DE DATOS ---
        const useFirebaseData = (collectionName, defaultValue, localStorageKey) => {
            const [data, setData] = useState(() => safeLoad(localStorageKey, defaultValue));
            useEffect(() => {
                let unsubscribe;
                if (db) {
                    try {
                        const q = query(collection(db, collectionName));
                        unsubscribe = onSnapshot(q, (snapshot) => {
                            const items = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                            items.sort((a, b) => b.id - a.id);
                            setData(items);
                        }, () => {
                            const localData = safeLoad(localStorageKey, defaultValue);
                            setData(localData);
                        });
                    } catch(e) {}
                }
                return () => { if(unsubscribe) unsubscribe(); }
            }, [collectionName]);
            return data;
        };

        const REPORT_TYPES = [
            { id: 'accident', label: 'Accidente', icon: Siren, color: '#ef4444' },
            { id: 'fire', label: 'Incendio', icon: Flame, color: '#f97316' },
            { id: 'security', label: 'Seguridad', icon: Shield, color: '#3b82f6' },
            { id: 'other', label: 'Otro', icon: AlertTriangle, color: '#64748b' },
        ];

        // --- COMPONENTES VISUALES ---

        const LeafletMap = ({ reports, onMapClick, onMarkerClick, userLoc }) => {
            const mapContainer = useRef(null);
            const mapInstance = useRef(null);
            
            useEffect(() => {
                if (!mapInstance.current && mapContainer.current) {
                    const map = L.map(mapContainer.current, { zoomControl: false, attributionControl: false }).setView([-36.6158, -72.9575], 14);
                    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', { attribution: 'Tiles &copy; Esri', maxZoom: 19 }).addTo(map);
                    mapInstance.current = map;
                    map.on('click', (e) => onMapClick(e.latlng));
                    setTimeout(() => map.invalidateSize(), 200);
                }

                const map = mapInstance.current;
                if(map) {
                    map.eachLayer(l => { if(l instanceof L.Marker) map.removeLayer(l); });
                    reports.forEach(r => {
                        let color = '#64748b';
                        if(r.mode === 'request_help') color = '#ef4444'; // Rojo Urgencia
                        else if (r.mode === 'offer_help') color = '#10b981'; // Verde Ayuda
                        else if (r.type) {
                             const type = REPORT_TYPES.find(t => t.id === r.type);
                             if(type) color = type.color;
                        }

                        const iconHtml = `<div style="display:flex; flex-direction:column; align-items:center;">
                            <div style="width:40px; height:40px; border-radius:50%; background:${color}; display:flex; align-items:center; justify-content:center; border:3px solid white; box-shadow:0 4px 10px rgba(0,0,0,0.5); ${r.mode === 'request_help' ? 'animation: pulse 1s infinite;' : ''}">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                    ${r.mode === 'request_help' ? '<path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>' : 
                                      r.mode === 'offer_help' ? '<path d="M4.5 12.5l5 5l9-9.5"/>' : '<circle cx="12" cy="12" r="10"/>'}
                                </svg>
                            </div>
                        </div>`;
                        const icon = L.divIcon({ html: iconHtml, className: '', iconSize: [40, 50], iconAnchor: [20, 45] });
                        const marker = L.marker([r.lat, r.lng], { icon }).addTo(map);
                        marker.on('click', () => onMarkerClick(r));
                    });
                }
            }, [reports]);

            useEffect(() => {
                if(mapInstance.current && userLoc) mapInstance.current.flyTo([userLoc.lat, userLoc.lng], 16, { duration: 1.5 });
            }, [userLoc]);

            return <div ref={mapContainer} className="w-full h-full" />;
        };

        const TheEye = ({ mousePos, isAwake }) => {
            const eyeRef = useRef(null);
            const [pupil, setPupil] = useState({x:0, y:0});
            useEffect(() => {
                if(!eyeRef.current || !isAwake) return setPupil({x:0,y:0});
                const rect = eyeRef.current.getBoundingClientRect();
                const ang = Math.atan2(mousePos.y - (rect.top + rect.height/2), mousePos.x - (rect.left + rect.width/2));
                const dist = Math.min(rect.width/4, 15);
                setPupil({x: Math.cos(ang)*dist, y: Math.sin(ang)*dist});
            }, [mousePos, isAwake]);
            return (
                <div ref={eyeRef} className="relative w-48 h-28 bg-white rounded-full flex items-center justify-center shadow-[0_0_50px_rgba(255,255,255,0.2)] overflow-hidden transition-transform hover:scale-105 duration-300 animate-float">
                    <div className="w-20 h-20 bg-black rounded-full flex items-center justify-center transition-transform duration-75 shadow-inner" style={{transform: `translate(${pupil.x}px, ${pupil.y}px)`}}>
                        <div className="w-6 h-6 bg-white rounded-full absolute top-3 right-3 opacity-90"></div>
                    </div>
                </div>
            );
        };

        const MusicDiadem = ({ tracks, isOpen, onClose }) => {
            const [idx, setIdx] = useState(0);
            const [playing, setPlaying] = useState(false);
            if(!tracks || tracks.length === 0) return null;
            const current = tracks[idx];
            return (
                <div className={`fixed top-0 left-0 w-full z-[100] transition-transform duration-500 ${isOpen ? 'translate-y-0' : '-translate-y-full'}`}>
                    <div className={`diadema pt-safe pb-4 px-4 ${playing ? 'animate-vibrate' : ''}`}>
                        <div className="max-w-3xl mx-auto flex items-center justify-between gap-4">
                            <div className="flex items-center gap-3 overflow-hidden flex-1">
                                <div className={`w-10 h-10 bg-gold-500 rounded-full flex items-center justify-center text-black shadow-lg ${playing ? 'animate-spin-slow' : ''}`}><Music size={18}/></div>
                                <div className="min-w-0">
                                    <h3 className="font-bold text-white truncate text-sm">{current.title}</h3>
                                    <p className="text-[10px] text-gold-500 tracking-widest uppercase font-bold flex items-center gap-1">{playing && <span className="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span>}Soy Tomé Play</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-4">
                                <button onClick={()=>setPlaying(!playing)} className="w-12 h-12 bg-white text-black rounded-full flex items-center justify-center">{playing ? <Pause size={20} fill="black"/> : <Play size={20} fill="black" className="ml-1"/>}</button>
                            </div>
                            <button onClick={onClose} className="text-zinc-500 hover:text-red-500"><X size={18}/></button>
                        </div>
                        {playing && <div className="absolute opacity-0 w-1 h-1 overflow-hidden pointer-events-none"><iframe src={current.sunoUrl} allow="autoplay" width="100" height="100"></iframe></div>}
                    </div>
                </div>
            );
        };

        // --- COMPONENTE CRISIS ACTION (MODAL DE REPORTE) ---
        const CreateReportModal = ({ lat, lng, onClose, db }) => {
            const [mode, setMode] = useState(null); // 'request_help', 'offer_help', 'incident', null
            const [form, setForm] = useState({ name: '', contact: '', desc: '', type: 'other' });
            const [loading, setLoading] = useState(false);

            const handleSubmit = async () => {
                if(!form.name) return alert("Por favor ingresa tu nombre");
                if(mode === 'request_help' && !form.contact) return alert("El contacto es obligatorio para pedir ayuda");
                if(mode === 'incident' && !form.desc) return alert("Describe el incidente");

                setLoading(true);
                
                const report = {
                    ...form, lat, lng,
                    mode,
                    date: new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}),
                    timestamp: Date.now()
                };
                
                try {
                    if(db) {
                        await addDoc(collection(db, 'reports'), report);
                        alert("¡Alerta Enviada a la Red!");
                    } else {
                        const localReports = safeLoad('st_reports', []);
                        localStorage.setItem('st_reports', JSON.stringify([report, ...localReports]));
                        alert("Guardado Localmente (Sin conexión)");
                    }
                } catch(e) { console.error(e); alert("Error guardando reporte"); }
                
                setLoading(false);
                onClose();
            };

            // VISTA 1: SELECCIÓN DE MODO
            if (!mode) {
                return (
                    <div className="fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-end sm:items-center justify-center sm:p-4 animate-fade-in">
                        <div className="bg-zinc-900 w-full max-w-md sm:rounded-3xl rounded-t-3xl p-6 shadow-2xl relative border-t border-white/20">
                            <button onClick={onClose} className="absolute top-4 right-4 bg-white/10 p-2 rounded-full text-white"><X size={20}/></button>
                            <h3 className="text-2xl font-black text-white mb-2 text-center">CENTRO DE ACCIÓN</h3>
                            <p className="text-zinc-400 text-center mb-8 text-sm">Selecciona el tipo de alerta para esta ubicación</p>
                            
                            <div className="space-y-4">
                                <button onClick={()=>setMode('request_help')} className="w-full bg-red-600 hover:bg-red-500 py-5 rounded-2xl flex items-center justify-center gap-3 text-white font-black text-lg shadow-lg shadow-red-900/40 transform active:scale-95 transition">
                                    <Siren className="animate-pulse"/> SOLICITAR AYUDA
                                </button>
                                
                                <button onClick={()=>setMode('offer_help')} className="w-full bg-emerald-600 hover:bg-emerald-500 py-5 rounded-2xl flex items-center justify-center gap-3 text-white font-black text-lg shadow-lg shadow-emerald-900/40 transform active:scale-95 transition">
                                    <HandHeart/> OFRECER AYUDA
                                </button>
                                
                                <button onClick={()=>setMode('incident')} className="w-full bg-zinc-800 hover:bg-zinc-700 py-5 rounded-2xl flex items-center justify-center gap-3 text-zinc-300 font-bold text-lg border border-white/10 transform active:scale-95 transition">
                                    <Megaphone/> REPORTAR INCIDENTE
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // VISTA 2: FORMULARIO CONTEXTUAL
            return (
                <div className="fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-end sm:items-center justify-center sm:p-4 animate-fade-in">
                    <div className="bg-zinc-900 w-full max-w-md sm:rounded-3xl rounded-t-3xl p-6 shadow-2xl relative border-t border-white/20">
                        <div className="flex items-center gap-3 mb-6">
                            <button onClick={()=>setMode(null)} className="p-2 bg-white/5 rounded-full text-white"><ArrowLeft size={20}/></button>
                            <h3 className="text-xl font-bold text-white uppercase tracking-wider">
                                {mode === 'request_help' ? 'SOLICITUD DE AYUDA' : mode === 'offer_help' ? 'OFRECER AYUDA' : 'NUEVO INCIDENTE'}
                            </h3>
                        </div>

                        <div className="space-y-4">
                            <div>
                                <label className="text-xs font-bold text-zinc-500 uppercase mb-2 block">Tu Nombre o Apodo (Público)</label>
                                <input value={form.name} onChange={e=>setForm({...form, name:e.target.value})} className="w-full bg-black border border-zinc-700 p-4 rounded-xl text-white outline-none focus:border-gold-500 font-bold text-lg" placeholder="Ej: Juan de Dichato" autoFocus />
                            </div>

                            {mode === 'request_help' && (
                                <div className="animate-fade-in">
                                    <label className="text-xs font-bold text-red-500 uppercase mb-2 block">Teléfono / WhatsApp (Vital)</label>
                                    <input value={form.contact} onChange={e=>setForm({...form, contact:e.target.value})} className="w-full bg-black border border-red-900/50 p-4 rounded-xl text-white outline-none focus:border-red-500" placeholder="+569..." />
                                </div>
                            )}

                            {mode === 'incident' && (
                                <div className="grid grid-cols-3 gap-2 animate-fade-in">
                                    {REPORT_TYPES.map(t => (
                                        <button key={t.id} onClick={()=>setForm({...form, type:t.id})}
                                            className={`p-3 rounded-xl border flex flex-col items-center gap-1 transition ${form.type===t.id ? 'bg-gold-500 text-black border-gold-500' : 'border-zinc-700 text-zinc-500 hover:bg-zinc-800'}`}>
                                            <t.icon size={20}/> <span className="text-[9px] font-bold uppercase">{t.label}</span>
                                        </button>
                                    ))}
                                </div>
                            )}

                            <div>
                                <label className="text-xs font-bold text-zinc-500 uppercase mb-2 block">Detalles Adicionales</label>
                                <textarea value={form.desc} onChange={e=>setForm({...form, desc:e.target.value})} className="w-full bg-black border border-zinc-700 p-4 rounded-xl text-white outline-none focus:border-gold-500 h-24" placeholder={mode === 'request_help' ? "¿Qué necesitas urgentemente?" : "Describe la situación..."}></textarea>
                            </div>

                            <button onClick={handleSubmit} disabled={loading} 
                                className={`w-full py-4 rounded-xl font-black text-lg shadow-lg flex items-center justify-center gap-2 transform active:scale-95 transition
                                ${mode === 'request_help' ? 'bg-red-600 hover:bg-red-500 text-white' : mode === 'offer_help' ? 'bg-emerald-600 hover:bg-emerald-500 text-white' : 'bg-gold-500 hover:bg-gold-400 text-black'}`}>
                                {loading ? <Loader2 className="animate-spin"/> : (mode === 'request_help' ? 'PEDIR AYUDA AHORA' : 'PUBLICAR')}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        const App = () => {
            const cloudPosts = useFirebaseData('posts', [], 'st_cnt_posts');
            const cloudMusic = useFirebaseData('music', [], 'st_cnt_music');
            const cloudReports = useFirebaseData('reports', [], 'st_reports');
            
            const localPosts = !db ? safeLoad('st_cnt_posts', []) : [];
            const localMusic = !db ? safeLoad('st_cnt_music', []) : [];

            const posts = db ? cloudPosts : localPosts;
            const music = db ? cloudMusic : localMusic;
            const reports = db ? cloudReports : safeLoad('st_reports', []);

            const [view, setView] = useState('home');
            const [awake, setAwake] = useState(false);
            const [mousePos, setMousePos] = useState({x:0, y:0});
            const [musicOpen, setMusicOpen] = useState(false);
            
            // Map Logic
            const [userLoc, setUserLoc] = useState(null);
            const [createLoc, setCreateLoc] = useState(null);
            const [showCreateReport, setShowCreateReport] = useState(false);

            const wakeUp = () => { if(!awake) setAwake(true); };
            
            useEffect(() => {
                const move = (e) => {
                    const x = e.touches ? e.touches[0].clientX : e.clientX;
                    const y = e.touches ? e.touches[0].clientY : e.clientY;
                    if(x && y) setMousePos({x, y});
                };
                window.addEventListener('mousemove', move); window.addEventListener('touchmove', move);
                return () => { window.removeEventListener('mousemove', move); window.removeEventListener('touchmove', move); }
            }, []);

            useEffect(() => {
                if(view === 'map' && navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(p => setUserLoc({lat: p.coords.latitude, lng: p.coords.longitude}));
                }
            }, [view]);

            const handleMapClick = (latlng) => {
                setCreateLoc(latlng);
                setShowCreateReport(true);
            };

            return (
                <div className={`min-h-screen font-sans text-white ${awake?'system-awake':'system-sleeping'}`} onClick={wakeUp} onTouchStart={wakeUp}>
                    <div className="bg-liquid-gold animate-liquid-gold"></div>

                    {awake && <MusicDiadem tracks={music} isOpen={musicOpen} onClose={()=>setMusicOpen(false)} />}

                    <nav className={`fixed top-0 w-full z-40 p-4 flex justify-between items-center transition-all duration-500 ${musicOpen ? 'translate-y-20' : ''}`}>
                        <div onClick={()=>setView('home')} className="font-black text-2xl tracking-tighter cursor-pointer">ST.</div>
                    </nav>

                    {view === 'home' && (
                        <main className="min-h-screen flex flex-col items-center justify-center p-6 text-center relative z-10">
                            <TheEye mousePos={mousePos} isAwake={awake} />
                            <h1 className="text-5xl md:text-7xl font-black tracking-tighter text-white drop-shadow-2xl mt-8">SOY TOMÉ</h1>
                            <p className="text-gold-400 mt-2 tracking-widest text-sm uppercase">Red de Respuesta</p>
                            <div className="mt-12 flex flex-wrap justify-center gap-4 w-full max-w-sm">
                                <button onClick={()=>setView('map')} className="flex-1 py-4 bg-zinc-800 border border-white/20 font-black rounded-2xl flex items-center justify-center gap-2 hover:bg-zinc-700 transition"><MapPin size={18}/> MAPA</button>
                                <button onClick={(e)=>{e.stopPropagation(); setMusicOpen(true)}} className="w-full py-3 bg-gradient-to-r from-gold-600 to-yellow-500 text-black font-black rounded-full hover:scale-105 transition shadow-lg flex items-center justify-center gap-2"><Music size={18}/> PLAY</button>
                            </div>
                        </main>
                    )}

                    {view === 'map' && (
                        <div className="absolute inset-0 z-0">
                            <LeafletMap 
                                reports={reports} 
                                userLoc={userLoc} 
                                onMapClick={handleMapClick} 
                                onMarkerClick={(r) => {
                                    alert(`Reporte: ${r.desc}\nContacto: ${r.contact || 'No disponible'}`);
                                }}
                            />
                            <button onClick={()=>setView('home')} className="fixed bottom-6 left-6 z-[1000] bg-zinc-900 p-3 rounded-full shadow-lg text-white"><ArrowLeft/></button>
                            <button onClick={()=>{ if(userLoc) { setCreateLoc(userLoc); setShowCreateReport(true); } else alert("Activando GPS..."); }} className="fixed bottom-6 right-6 z-[1000] bg-crisis-red text-white p-4 rounded-full shadow-lg font-bold flex items-center gap-2 animate-pulse"><Siren/> ALERTA</button>
                        </div>
                    )}

                    {showCreateReport && createLoc && <CreateReportModal lat={createLoc.lat} lng={createLoc.lng} onClose={()=>setShowCreateReport(false)} db={db}/>}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>